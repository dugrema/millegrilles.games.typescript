import{a as d,p as r,w as N,t as R}from"./chunk-EPOLDU6W-BRx3iYW4.js";const k={0:Array(16).fill(0),1:[0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0],2:[1,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],3:[0,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0],4:[1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,0],5:[0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0],6:[0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0],7:[1,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0]};function $(e){const s=Array(16).fill(0);for(let t=0;t<16;t++){const i=t%4,n=Math.floor(t/4);s[i*4+(3-n)]=e[t]}return s}function f(){const e=Math.floor(Math.random()*7)+1;return{type:e,shape:k[e],rotation:0,x:3,y:0}}const v=20,w=10;function P(){return Array.from({length:v},()=>Array(w).fill(0))}function b(e,s){const{shape:t,x:i,y:n}=s;for(let c=0;c<16;c++){if(!t[c])continue;const o=i+c%4,l=n+Math.floor(c/4);if(o<0||o>=w||l<0||l>=v||e.grid[l][o]!==0)return!1}return!0}function A(e,s){const t=e.grid.map(i=>i.slice());for(let i=0;i<16;i++){if(!s.shape[i])continue;const n=s.x+i%4,c=s.y+Math.floor(i/4);c>=0&&c<v&&n>=0&&n<w&&(t[c][n]=s.type)}return t}function M(e){const s=[];let t=0;for(let i=v-1;i>=0;i--){if(e[i].every(n=>n!==0)){t++;continue}s.unshift(e[i])}for(;s.length<v;)s.unshift(Array(w).fill(0));return{newGrid:s,cleared:t}}function O(e,s){switch(s.type){case"SPAWN_PIECE":return{...e,piece:s.payload.piece,nextPiece:s.payload.nextPiece};case"MOVE":{if(!e.piece)return e;const i={...e.piece,x:e.piece.x+s.payload.dx,y:e.piece.y+s.payload.dy};return b(e,i)?{...e,piece:i}:e}case"ROTATE":{if(!e.piece)return e;const i=$(e.piece.shape),n={...e.piece,shape:i,rotation:(e.piece.rotation+1)%4};return b(e,n)?{...e,piece:n}:e}case"LOCK":case"HARD_DROP":{if(!e.piece)return e;const i=s.type==="HARD_DROP"?(()=>{let h=e.piece.y;for(;b(e,{...e.piece,y:h+1});)h++;return{...e.piece,y:h}})():e.piece,n=A(e,i),{newGrid:c,cleared:o}=M(n),l=e.score+o*100,a=Math.floor(e.linesCleared/10)+1,p=Math.max(l,e.highScore),u=e.linesCleared+o,x={...e,grid:c,score:l,level:a,linesCleared:u,highScore:p,piece:null,gameOver:!1,isPaused:!1};return b(x,e.nextPiece)?{...x,piece:e.nextPiece,nextPiece:f()}:{...x,gameOver:!0,piece:null}}case"TICK":if(!e.piece||e.isPaused)return e;const t={...e.piece,y:e.piece.y+1};return b(e,t)?{...e,piece:t}:O(e,{type:"LOCK"});case"SET_HIGH_SCORE":return{...e,highScore:s.payload};case"GAME_OVER":return{...e,gameOver:!0};case"RESET":return{grid:P(),piece:null,nextPiece:f(),score:0,level:1,linesCleared:0,highScore:e.highScore,gameOver:!1,isPaused:!1};case"PAUSE":return{...e,isPaused:!0};case"RESUME":return{...e,isPaused:!1};default:return e}}const j=d.createContext({state:{grid:P(),piece:null,nextPiece:f(),score:0,level:1,linesCleared:0,highScore:0,gameOver:!1,isPaused:!1},dispatch:()=>{}}),G=({children:e})=>{const[s,t]=d.useReducer(O,{grid:P(),piece:null,nextPiece:f(),score:0,level:1,linesCleared:0,highScore:0,gameOver:!1,isPaused:!1});return d.useEffect(()=>{const i=localStorage.getItem("tetris-high-score");i&&t({type:"SET_HIGH_SCORE",payload:parseInt(i,10)})},[]),d.useEffect(()=>{localStorage.setItem("tetris-high-score",s.highScore.toString())},[s.highScore]),d.useEffect(()=>{if(s.gameOver||s.isPaused)return;const i=setInterval(()=>{t({type:"TICK"})},Math.max(100,800-(s.level-1)*50));return()=>clearInterval(i)},[s.level,s.gameOver,s.isPaused]),d.useEffect(()=>{if(!s.piece&&!s.gameOver){const i=f();t({type:"SPAWN_PIECE",payload:{piece:i,nextPiece:f()}})}},[s.piece,s.gameOver]),d.useEffect(()=>{if(s.gameOver)return;const i=n=>{if(n.key.toLowerCase()==="p"){t(s.isPaused?{type:"RESUME"}:{type:"PAUSE"});return}if(!s.isPaused&&s.piece)switch(n.key){case"ArrowLeft":t({type:"MOVE",payload:{dx:-1,dy:0}});break;case"ArrowRight":t({type:"MOVE",payload:{dx:1,dy:0}});break;case"ArrowDown":t({type:"MOVE",payload:{dx:0,dy:1}});break;case"ArrowUp":t({type:"ROTATE"});break;case" ":case"Spacebar":t({type:"HARD_DROP"});break}};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[t,s.piece,s.gameOver,s.isPaused]),r.jsx(j.Provider,{value:{state:s,dispatch:t},children:e})};function D(){const{state:e,dispatch:s}=d.useContext(j);if(!e.gameOver)return null;const t=()=>{s({type:"RESET"})};return r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",children:r.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg text-center max-w-xs w-full",children:[r.jsx("h2",{className:"text-3xl font-bold mb-4 text-white",children:"Game Over"}),r.jsxs("p",{className:"text-white mb-2",children:["Score: ",e.score]}),r.jsxs("p",{className:"text-white mb-4",children:["High Score: ",e.highScore]}),r.jsx("button",{onClick:t,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none",children:"Restart"})]})})}function L(){const{state:e,dispatch:s}=d.useContext(j),{grid:t,piece:i}=e,n=20,c=(l,a,p)=>{const u={width:`${n}px`,height:`${n}px`,backgroundColor:p?`hsl(${p*45}, 70%, 50%)`:"#111",border:"1px solid #333",boxSizing:"border-box",position:"absolute",left:`${a*n}px`,top:`${l*n}px`};return r.jsx("div",{style:u},`${l}-${a}`)},o=()=>{if(!i)return null;const{shape:l,x:a,y:p,type:u}=i,x=[];return l.forEach((h,m)=>{if(!h)return;const y=a+m%4,g=p+Math.floor(m/4);g<0||x.push(r.jsx("div",{style:{width:`${n}px`,height:`${n}px`,backgroundColor:`hsl(${u*45}, 70%, 50%)`,border:"1px solid #333",boxSizing:"border-box",position:"absolute",left:`${y*n}px`,top:`${g*n}px`}},`p-${g}-${y}`))}),x};return r.jsxs("div",{style:{position:"relative",width:`${n*10}px`,height:`${n*20}px`,backgroundColor:"#222",margin:"0 auto"},children:[t.flatMap((l,a)=>l.map((p,u)=>c(a,u,p))),o()]})}function T(){const{state:e,dispatch:s}=d.useContext(j),{score:t,level:i,nextPiece:n,linesCleared:c,gameOver:o,isPaused:l}=e,a=(h,m)=>{!e.piece||o||s({type:"MOVE",payload:{dx:h,dy:m}})},p=()=>{!e.piece||o||s({type:"ROTATE"})},u=()=>{!e.piece||o||s({type:"HARD_DROP"})},x=()=>{const m={width:"48px",height:"48px",position:"relative",backgroundColor:"#333",margin:"0 auto"},y=[];return n.shape.forEach((g,E)=>{if(!g)return;const C=E%4+1,S=Math.floor(E/4)+1;S<0||y.push(r.jsx("div",{style:{width:"12px",height:"12px",backgroundColor:`hsl(${n.type*45}, 70%, 50%)`,border:"1px solid #555",boxSizing:"border-box",position:"absolute",left:`${C*12}px`,top:`${S*12}px`}},`np-${S}-${C}`))}),r.jsx("div",{style:m,children:y})};return r.jsxs("aside",{className:"p-4 bg-gray-800 text-white w-48 sm:w-auto mx-auto",children:[r.jsxs("div",{className:"block sm:hidden",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs",children:[r.jsxs("div",{children:[r.jsxs("p",{children:["⚙️ ",t]}),r.jsxs("p",{children:["Lv: ",i]}),r.jsxs("p",{children:["Ln: ",c]})]}),r.jsx("div",{className:"ml-2",children:x()})]}),r.jsxs("div",{className:"flex justify-between mt-4",children:[r.jsx("button",{onClick:()=>a(-1,0),disabled:o||!e.piece,className:"px-2 py-1 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-50",children:"←"}),r.jsx("button",{onClick:p,disabled:o||!e.piece,className:"px-2 py-1 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-50",children:"↻"}),r.jsx("button",{onClick:()=>a(1,0),disabled:o||!e.piece,className:"px-2 py-1 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-50",children:"→"}),r.jsx("button",{onClick:u,disabled:o||!e.piece,className:"px-2 py-1 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-50",children:"⏬"})]})]}),r.jsxs("div",{className:"hidden sm:block",children:[r.jsxs("div",{className:"mb-2",children:[r.jsxs("span",{className:"font-medium",children:["Pause: ",l?"On":"Off"]}),r.jsx("p",{className:"text-xs text-gray-300",children:"Press “p” to toggle"})]}),r.jsx("h2",{className:"font-medium mb-2",children:"Score"}),r.jsx("p",{className:"text-2xl",children:t}),r.jsx("h3",{className:"font-medium mt-4 mb-2",children:"Level"}),r.jsx("p",{children:i}),r.jsx("h3",{className:"font-medium mt-4 mb-2",children:"Lines"}),r.jsx("p",{children:c}),r.jsx("h3",{className:"font-medium mt-4 mb-2",children:"Next"}),x(),r.jsxs("div",{className:"mt-4 text-xs",children:[r.jsx("p",{children:"← → Rotate"}),r.jsx("p",{children:"↓ Drop"}),r.jsx("p",{children:"Space = Hard Drop"}),r.jsx("p",{children:"p = Pause / Resume"})]})]})]})}function _(){const{state:e,dispatch:s}=d.useContext(j),t=()=>{s({type:e.isPaused?"RESUME":"PAUSE"})};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"sm:hidden mb-1 flex items-center gap-2",children:[r.jsx(R,{to:"/games",className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Exit"}),r.jsx("button",{onClick:t,className:"px-3 py-1 bg-yellow-600 text-white rounded",children:e.isPaused?"Resume":"Pause"})]}),r.jsx("h1",{className:"text-3xl font-bold mt-0 mb-0 sm:block hidden",children:"Tetris"}),r.jsxs("section",{className:"flex flex-col sm:flex-row sm:gap-2 sm:justify-center w-full max-w-4xl",children:[r.jsx("div",{className:"flex justify-center",children:r.jsx(L,{})}),r.jsx("div",{className:"w-full sm:w-48 sm:flex-shrink-0",children:r.jsx(T,{})})]}),r.jsx(D,{})]})}const H=N(function(){return r.jsx(G,{children:r.jsx("main",{className:"flex flex-col items-center min-h-96 p-4 sm:p-4 sm:gap-1",children:r.jsx(_,{})})})});export{H as default};
