import{a as s,p as t,x as M,w as B}from"./chunk-EPOLDU6W-BRx3iYW4.js";function U(){return typeof window>"u"||!window.localStorage?0:parseInt(window.localStorage.getItem("flappyBirdHighScore")||"0",10)}const E={bird:{x:100,y:300,width:40,height:40,velocity:0,rotation:0,color:"#FFD700"},pipes:[],score:{current:0,highScore:U()},status:"IDLE",gameOverReason:""};function z(e,r){switch(r.type){case"JUMP":if(e.status!=="PLAYING")return e;const i={...e.bird,velocity:-9};return{...e,bird:i};case"GAME_START":return{...E,bird:{...E.bird,x:100,y:300,velocity:0},status:"PLAYING"};case"PAUSE":return{...e,status:"PAUSED"};case"RESUME":return{...e,status:"PLAYING"};case"GAME_OVER":const c={...e.score,current:e.score.current};return e.score.current>e.score.highScore&&(c.highScore=e.score.current,typeof window<"u"&&window.localStorage&&window.localStorage.setItem("flappyBirdHighScore",e.score.current.toString())),{...e,score:c,status:"GAME_OVER",gameOverReason:r.payload||""};case"ADD_SCORE":return{...e,score:{...e.score,current:e.score.current+1}};case"UPDATE_LOCAL_STATE":return{...e,bird:r.payload?.bird||e.bird,pipes:r.payload?.pipes||e.pipes};case"RESET":return{...E,bird:{...E.bird,x:100,y:300},status:"IDLE"};default:return e}}const k=s.createContext(void 0);function H({children:e}){const[r,i]=s.useReducer(z,E),c=()=>{console.log("GameContext: startGame called"),i({type:"GAME_START"})},u=()=>i({type:"PAUSE"}),n=()=>i({type:"RESUME"}),p=()=>i({type:"JUMP"}),a=d=>i({type:"GAME_OVER",payload:d}),x=()=>i({type:"RESET"});return t.jsx(k.Provider,{value:{state:r,dispatch:i,startGame:c,pauseGame:u,resumeGame:n,jump:p,handleGameOver:a,resetGame:x},children:e})}function T(){const e=s.useContext(k);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e}const R=480,b=640,Y=.5,$=-9,w=60,I=160,A=100,D=300,V=3,_=1,K=3,W=100,f={SKY_TOP:"#70c5ce",SKY_BOTTOM:"#4fc3f7",GROUND:"#ded895",GROUND_GRASS:"#73bf2e",PIPE_GREEN:"#73bf2e",PIPE_DARK_GREEN:"#2e7d32",PIPE_BORDER:"#2e7d32"},J=({bird:e})=>{const{x:r,y:i,width:c,height:u,rotation:n,color:p}=e;return t.jsx("div",{style:{position:"absolute",left:`${r}px`,top:`${i}px`,width:`${c}px`,height:`${u}px`,transform:`rotate(${n}rad)`,pointerEvents:"none"},children:t.jsxs("div",{style:{width:"100%",height:"100%",background:p,borderRadius:"50% 50% 50% 50%",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.2)"},children:[t.jsx("div",{style:{position:"absolute",left:"60%",top:"20%",width:"30%",height:"30%",background:"white",borderRadius:"50%",border:"3px solid #333",zIndex:2}}),t.jsx("div",{style:{position:"absolute",left:"70%",top:"35%",width:"50%",height:"50%",background:"#333",borderRadius:"50%"}}),t.jsx("div",{style:{position:"absolute",left:"20%",top:"45%",width:"50%",height:"30%",background:"#e6c200",borderRadius:"50% 50% 0 0",transform:"rotate(-20deg)",zIndex:1}})]})})},q=({pipes:e})=>t.jsx(t.Fragment,{children:e.map((r,i)=>t.jsxs("div",{style:{position:"absolute",left:`${r.x}px`,top:"0px",width:`${w}px`,height:`${b}px`,display:"flex",flexDirection:"column"},children:[t.jsxs("div",{style:{width:"100%",height:`${r.height}px`,background:f.PIPE_GREEN,borderTopLeftRadius:"6px",borderTopRightRadius:"6px",position:"relative"},children:[t.jsx("div",{style:{position:"absolute",top:"-4px",left:"0",width:"100%",height:"8px",background:f.PIPE_DARK_GREEN,borderTopLeftRadius:"6px",borderTopRightRadius:"6px"}}),t.jsx("div",{style:{position:"absolute",top:"0",left:"0",width:"4px",height:"100%",background:f.PIPE_BORDER}}),t.jsx("div",{style:{position:"absolute",top:"0",right:"0",width:"4px",height:"100%",background:f.PIPE_BORDER}})]}),t.jsx("div",{style:{width:"100%",height:`${r.gap}px`}}),t.jsxs("div",{style:{width:"100%",height:`${b-r.height-r.gap}px`,background:f.PIPE_GREEN,borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px",position:"relative"},children:[t.jsx("div",{style:{position:"absolute",bottom:"-4px",left:"0",width:"100%",height:"8px",background:f.PIPE_DARK_GREEN,borderBottomLeftRadius:"6px",borderBottomRightRadius:"6px"}}),t.jsx("div",{style:{position:"absolute",top:"0",left:"0",width:"4px",height:"100%",background:f.PIPE_BORDER}}),t.jsx("div",{style:{position:"absolute",top:"0",right:"0",width:"4px",height:"100%",background:f.PIPE_BORDER}})]})]},i))}),X=({current:e,highScore:r,isGameActive:i=!0})=>t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"score-display",style:{position:"absolute",top:"20px",left:"20px",fontSize:"48px",fontWeight:"bold",color:"white",fontFamily:"monospace",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)",zIndex:10},children:e}),r!==void 0&&t.jsxs("div",{className:"high-score-display",style:{position:"absolute",top:"20px",right:"20px",fontSize:"18px",fontWeight:"bold",color:"rgba(255, 255, 255, 0.8)",fontFamily:"monospace",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.5)",zIndex:10},children:["High Score: ",r]})]}),Q=({state:e,currentScore:r,highScore:i,startGame:c,onRestart:u})=>{const n=()=>{c()},p=()=>{u()};return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
          @media (max-width: 649px) {
            .idle-header {
              display: none;
            }
          }
        `}),e.status==="IDLE"&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:100},children:[t.jsxs("div",{className:"idle-header",children:[t.jsx("h1",{style:{color:"white",fontSize:"48px",marginBottom:"20px",fontFamily:"Arial, sans-serif"},children:"Flappy Bird"}),t.jsx("p",{style:{color:"white",fontSize:"20px",marginBottom:"40px",fontFamily:"Arial, sans-serif"},children:"Press SPACE or TAP to play"})]}),t.jsx("button",{onClick:n,style:{padding:"15px 30px",fontSize:"24px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontFamily:"Arial, sans-serif",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:"START GAME"})]}),e.status==="GAME_OVER"&&t.jsxs("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:100},children:[t.jsx("h1",{style:{color:"#FF5722",fontSize:"48px",marginBottom:"20px",fontFamily:"Arial, sans-serif"},children:"GAME OVER"}),t.jsxs("p",{style:{color:"white",fontSize:"24px",marginBottom:"10px",fontFamily:"Arial, sans-serif"},children:["Score: ",e.score.current]}),e.score.current>e.score.highScore&&t.jsx("p",{style:{color:"#FFD700",fontSize:"20px",marginBottom:"20px",fontFamily:"Arial, sans-serif"},children:"New High Score!"}),t.jsx("p",{style:{color:"#e0e0e0",fontSize:"18px",marginBottom:"40px",fontFamily:"Arial, sans-serif"},children:"Press SPACE or TAP to restart"}),t.jsx("button",{onClick:p,style:{padding:"15px 30px",fontSize:"24px",background:"#4CAF50",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontFamily:"Arial, sans-serif",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:"PLAY AGAIN"})]}),e.status==="PAUSED"&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100},children:t.jsx("h2",{style:{color:"white",fontSize:"48px",fontFamily:"Arial, sans-serif"},children:"PAUSED"})})]})};function Z(){const e=M(),{state:{status:r},pauseGame:i,resumeGame:c}=T(),u=a=>{a.stopPropagation(),a.preventDefault(),e("/games")},n=a=>{a.stopPropagation(),a.preventDefault(),i()},p=a=>{a.stopPropagation(),a.preventDefault(),c()};return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
          .mobile-header {
            display: none;
          }
          @media (max-width: 649px) {
            .mobile-header {
              display: flex;
              position: fixed;
              top: 8px;
              left: 50%;
              transform: translateX(-50%);
              gap: 12px;
              z-index: 101;
            }
            .mobile-header button {
              background: #4caf50;
              color: white;
              border: none;
              border-radius: 4px;
              padding: 6px 12px;
              font-size: 14px;
              cursor: pointer;
            }
          }
        `}),t.jsxs("div",{className:"mobile-header",children:[t.jsx("button",{onClick:u,onTouchStart:u,"aria-label":"Exit to games list",children:"Exit"}),r==="PLAYING"&&t.jsx("button",{onClick:n,onTouchStart:n,"aria-label":"Pause game",children:"Pause"}),r==="PAUSED"&&t.jsx("button",{onClick:p,onTouchStart:p,"aria-label":"Resume game",children:"Resume"})]})]})}function ee(){const{state:e,dispatch:r,jump:i,handleGameOver:c,resetGame:u}=T(),n=s.useRef(void 0),p=s.useRef(!1),a=s.useRef(!1),x=s.useRef({...e.bird}),d=s.useRef([...e.pipes]),h=s.useRef(_),y=s.useRef(0);s.useEffect(()=>{x.current={...e.bird},d.current=[...e.pipes],y.current=0},[e.bird,e.pipes]);const v=(o,g)=>o.x<g.x+g.width&&o.x+o.width>g.x&&o.y<g.y+g.height&&o.y+o.height>g.y,G=s.useCallback(()=>{if(e.status!=="PLAYING")return;y.current++;const o=x.current;if(o.velocity+=Y,o.y+=o.velocity,o.rotation=Math.max(-.5,Math.min(.5,o.velocity*.05)),o.y+o.height>b){o.y=b-o.height,o.velocity=0,c("Ground collision");return}if(o.y<0){o.y=0,o.velocity=0,c("Ceiling collision");return}const g=d.current;if(g.length===0){const m=Math.random()*(D-A)+A;d.current.push({x:R,y:0,width:w,height:m,gap:I,passed:!1})}if(y.current%W===0){const m=Math.random()*(D-A)+A;d.current.push({x:R,y:0,width:w,height:m,gap:I,passed:!1})}for(let m=g.length-1;m>=0;m--){const l=g[m];if(l.x-=V*h.current,!l.passed&&l.x+l.width<x.current.x+x.current.width/2&&(l.passed=!0,r({type:"ADD_SCORE"}),y.current%5===0&&h.current<K&&(h.current+=.2)),l.x+l.width<0){d.current.splice(m,1);continue}const j={x:o.x,y:o.y,width:o.width,height:o.height},O={x:l.x,y:0,width:l.width,height:l.height},F={x:l.x,y:l.height+l.gap,width:l.width,height:b-l.height-l.gap};if(v(j,O)||v(j,F)){c("Pipe collision");return}}r({type:"UPDATE_LOCAL_STATE",payload:{bird:{...o},pipes:[...d.current]}})},[e.status,c,r]),S=s.useRef(null);S.current=s.useCallback(o=>{if(e.status==="PLAYING"){if(a.current){a.current=!1,n.current=requestAnimationFrame(S.current);return}G(),n.current=requestAnimationFrame(S.current)}},[e.status,G]),s.useEffect(()=>(e.status==="PLAYING"?n.current||(n.current=requestAnimationFrame(S.current)):(e.status==="PAUSED"||e.status==="GAME_OVER"||e.status==="IDLE")&&n.current&&(cancelAnimationFrame(n.current),n.current=void 0),()=>{n.current&&cancelAnimationFrame(n.current)}),[e.status]);const P=s.useCallback(()=>{e.status!=="PLAYING"&&(h.current=_,y.current=0,d.current=[],r({type:"GAME_START"}))},[e.status,r]),C=s.useCallback(()=>{e.status==="PLAYING"?r({type:"PAUSE"}):e.status==="PAUSED"&&(a.current=!0,r({type:"RESUME"}))},[e.status,r]),L=s.useCallback(()=>{n.current&&cancelAnimationFrame(n.current),u(),P()},[u,P]),N=s.useCallback(()=>{if(p.current||e.status!=="PLAYING")return;p.current=!0;const o=x.current;o.velocity=$,o.rotation=-.3,i(),setTimeout(()=>{p.current=!1},150)},[e.status,i]);return{state:e,jump:N,startGame:P,pauseGame:C,restartGame:L}}function te(){const{state:e,jump:r,startGame:i,pauseGame:c,restartGame:u}=ee(),n=s.useRef(null),p=s.useRef(null);return s.useEffect(()=>{const a=h=>{if(h.code==="Space")switch(h.preventDefault(),e.status){case"IDLE":case"GAME_OVER":i();break;case"PLAYING":r();break;case"PAUSED":c();break}h.code==="KeyP"&&(h.preventDefault(),(e.status==="PLAYING"||e.status==="PAUSED")&&c()),h.code==="Enter"&&(h.preventDefault(),u())},x=h=>{switch(h.preventDefault(),e.status){case"IDLE":case"GAME_OVER":i();break;case"PLAYING":case"PAUSED":r();break}},d=n.current;return d&&(d.addEventListener("keydown",a),d.addEventListener("touchstart",x,{passive:!1}),d.focus()),()=>{d&&(d.removeEventListener("keydown",a),d.removeEventListener("touchstart",x))}},[e.status,r,i,c,u]),s.useEffect(()=>{const a=()=>{const x=p.current;if(x){const d=Math.min(window.innerWidth-32,R),h=Math.min(window.innerHeight-32,b),y=Math.min(d/R,h/b);x.style.transform=`scale(${y})`}};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),t.jsxs(t.Fragment,{children:[t.jsx("style",{children:`
          @keyframes scrollGround {
            0% { background-position: 0 0; }
            100% { background-position: -800px 0; }
          }
          .ground {
            animation: scrollGround 3s linear infinite;
          }
          .game-container {
          }
          @media (max-width: 649px) {
            .game-container {
              margin-top: -40px;
            }
          }
        `}),t.jsx("div",{ref:p,className:"game-container",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"80vh",background:"#2c3e50",padding:"16px",overflow:"hidden"},children:t.jsxs("div",{ref:n,tabIndex:0,style:{position:"relative",width:`${R}px`,height:`${b}px`,background:`linear-gradient(to bottom, ${f.SKY_TOP}, ${f.SKY_BOTTOM})`,borderRadius:"8px",overflow:"hidden",boxShadow:"0 8x 16px rgba(0, 0, 0, 0.3)"},children:[t.jsx(Z,{}),t.jsx(X,{current:e.score.current,highScore:e.score.highScore}),t.jsx(J,{bird:e.bird}),t.jsx(q,{pipes:e.pipes}),t.jsx("div",{className:"ground",style:{position:"absolute",bottom:0,left:0,right:0,height:"100px",background:`linear-gradient(to bottom, ${f.GROUND}, ${f.GROUND_GRASS})`,borderTop:`4px solid ${f.GROUND_GRASS}`,backgroundSize:"2000px 100px"},children:t.jsx("div",{style:{position:"absolute",top:"8px",left:"0",right:"0",height:"8px",background:"repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(0,0,0,0.1) 20px, rgba(0,0,0,0.1) 40px)"}})}),t.jsx(Q,{currentScore:e.score.current,highScore:e.score.highScore,state:e,startGame:i,onRestart:u})]})})]})}const oe=B(function(){return t.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto",padding:"20px",minHeight:"100vh"},children:[t.jsx("h1",{style:{textAlign:"center",marginBottom:"20px",color:"#333"},children:"Flappy Bird"}),t.jsx(H,{children:t.jsx(te,{})})]})});export{oe as default};
